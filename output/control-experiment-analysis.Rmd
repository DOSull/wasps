---
title: "Analysis of control time series"
output:
  pdf_document: default
---

Load libraries
```{r}
library(dplyr)
library(ggplot2)
```

Read data
```{r}
setwd('~/Documents/code/working/wasps/output/')
wasps.control <- read.csv("wasps CONTROL-EXPERIMENT-table.csv", skip=6)
```

Select the variables we need. Also determine total wild and GM populations and do some renaming.
```{r}
wasps.sel <- wasps.control %>%
  select(1:2, 11, 15, 21:25) %>%
  rename(type1.pop = sum..item.1.pops..of.the.habitable.land,
         type2.pop = sum..item.2.pops..of.the.habitable.land) %>%
  mutate(gm.pop = type1.pop + type2.pop,
         wild.pop = total.pop - gm.pop)
```

Determine initial populations, and add to the data, and use to calculate population relative to initial.
```{r}
wasps.start.pop <- wasps.sel %>%
  filter(X.step. == 0) %>%
  select('X.run.number.', 'total.pop') %>%
  rename(initial.pop = total.pop)

wasps.sel <- wasps.sel %>%
  merge(wasps.start.pop, all.x=TRUE) %>%
  mutate(relative.pop = total.pop / initial.pop)
```


## Limit analysis to `r.mean==2`
At least until we get a handle on things
```{r}
wasps.to_analyse <- wasps.sel %>%
  filter(r.mean==2)
```

## Time series of the occupancy and population relative to initial
Note how population bottoms out in more mobile populations, but recovers to higher levels on reinvasion.
```{r}
ggplot(wasps.to_analyse, aes(x=X.step., group=X.run.number.)) + 
  geom_line(aes(y=prop.occupied, colour='Occupied area'), lwd=0.5, alpha=0.25) +
  geom_line(aes(y=relative.pop, colour='Population'), lwd=0.25, alpha=0.25) +
  labs(x = 'Time, years', y='Fraction of maximum', colour='Parameter') + 
  facet_grid(p.ldd ~ lambda.1, labeller=label_both, as.table=FALSE)
```

## The wild and GM population time series
```{r}
ggplot(wasps.to_analyse, aes(x=X.step., group=X.run.number.)) + 
  geom_line(aes(y=wild.pop, colour='Wild'), lwd=0.5, alpha=0.25) +
  geom_line(aes(y=gm.pop, colour='GM'), lwd=0.25, alpha=0.25) +
  labs(x='Time, years', y='Population', colour='Parameter') + 
  facet_grid(p.ldd ~ lambda.1, labeller=label_both, as.table=FALSE)
```


## State space
Just an experiment - note t>150

```{r}
ggplot(filter(wasps.to_analyse, X.step.>150), 
       aes(x=wild.pop, y=gm.pop, group=X.run.number.)) + 
  geom_point(size=0.1, alpha=0.25) +
  labs(x='Wild', y='GM') + 
  facet_grid(p.ldd ~ lambda.1, labeller=label_both, as.table=FALSE)
```