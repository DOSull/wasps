---
title: "Analysis of invasion times"
output:
  pdf_document: default
---

Data are time series of single site invasions from 30 randomly selected locations (same 30 sites for each parameter combination).

Load some libraries
```{r}
library(dplyr)
library(ggplot2)
library(scales)
```

Navigate to folder and read the data.
```{r}
setwd('~/Documents/code/working/wasps/output/')
wasps.invasion <- read.csv("wasps INVASION-EXPERIMENT-LAMBDA-table.csv", skip=6)
```

Select only variables we need.
```{r}
wasps.sel <- select(wasps.invasion, 1:2 ,11, 15, 21:23)
```

## Time series plots
Panel plot of time series, lines coloured by intrinsic growth-rate `r.mean`, panels arranged by local mean dispersal distance `lambda.1` and probability of long distance dispersal `p.ldd`.
```{r}
ggplot(filter(wasps.sel, lambda.1 %in% 1:3), aes(x=X.step., y=prop.occupied, color=as.factor(r.mean))) + 
  geom_line(aes(group=X.run.number.), lwd=.35, alpha=0.5) + 
  xlim(0, 150) + ylim(0, 1) +
  labs(x='Time, years', y='Proportion of land occupied') +
  scale_color_viridis_d(option='D') + 
  facet_grid(p.ldd ~ lambda.1, labeller=label_both, as.table=FALSE)
```

## Trends in time to 95% occupancy
Determine times taken to 95% occupancy. These will be the last time step in each case, when `prop.occupied` >=0.95 at that time, since experiment runs used this as stopping criterion.
```{r}
wasps.t <- wasps.sel %>% 
  group_by(X.run.number., r.mean) %>%
  summarise_at('X.step.', max) %>%
  merge(wasps.invasion) %>%
  filter(prop.occupied >= 0.95)
```

And plot it
```{r}
ggplot(wasps.t, aes(x=lambda.1, y=X.step.)) + 
  geom_jitter(aes(color=as.factor(p.ldd)), width=.01, height=0, size=.5) +
  scale_color_viridis_d(option='C', direction=-1) +
  facet_wrap(vars(r.mean), nrow=1, labeller=label_both) +
  labs(y='Time to 95% occupied', x='Local mean dispersal distance, km')
```

### Need more data to fit curves
To fit curves to these data we need more values of `lambda.1` than $\{0.5,2,5\}$ to avoid warnings about near-singularities with the default Loess fitting, and also unlikely 'kinks' in the curves. A linear model is clearly not appropriate per the plots. See below:

```{r}
ggplot(wasps.t, aes(x=lambda.1, y=X.step., colour=as.factor(p.ldd))) + 
  geom_smooth(aes(group=p.ldd)) +
  geom_point(size=0.5) +
  scale_colour_viridis_d(option='C', direction=-1) +
  facet_wrap(vars(r.mean), nrow=1, labeller=label_both) +
  labs(y='Time to 95% occupied', x='Local mean dispersal distance, km')
```
